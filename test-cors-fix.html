<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CORS –æ—à–∏–±–æ–∫</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 15px; border-radius: 8px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        button { padding: 12px 24px; margin: 8px; cursor: pointer; border: none; border-radius: 6px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CORS –∏ fetch –æ—à–∏–±–æ–∫</h1>
    
    <div class="result info">
        <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –æ—à–∏–±–æ–∫ "Failed to fetch" –∏ "body stream already read"
    </div>

    <h2>–¢–µ—Å—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç–≤–µ—Ç–æ–≤</h2>
    <button class="btn-primary" onclick="testWorkingAPI()">‚úÖ –¢–µ—Å—Ç —Ä–∞–±–æ—á–µ–≥–æ API (JSONPlaceholder)</button>
    <button class="btn-secondary" onclick="testCORSBlocked()">‚ùå –¢–µ—Å—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ CORS</button>
    <button class="btn-secondary" onclick="testInvalidURL()">‚ùå –¢–µ—Å—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ URL</button>
    
    <div id="results"></div>

    <script>
        async function testAPI(config) {
            const resultsDiv = document.getElementById('results');
            const startTime = Date.now();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–∞—á–∞–ª–æ
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result';
            resultDiv.innerHTML = `
                <h3>üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: ${config.name}</h3>
                <p><strong>URL:</strong> ${config.url}</p>
                <p><strong>–ú–µ—Ç–æ–¥:</strong> ${config.method}</p>
            `;
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
            
            try {
                const requestOptions = {
                    method: config.method,
                    headers: config.headers,
                    mode: 'cors'
                };

                if (config.body && config.method !== 'GET') {
                    requestOptions.body = config.body;
                }

                const response = await fetch(config.url, requestOptions);
                const duration = Date.now() - startTime;
                
                let responseData;
                const contentType = response.headers.get('content-type');
                
                try {
                    if (contentType && contentType.includes('application/json')) {
                        responseData = await response.json();
                    } else {
                        responseData = await response.text();
                    }
                } catch (parseError) {
                    try {
                        responseData = await response.text();
                    } catch (textError) {
                        responseData = `–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞: ${parseError}`;
                    }
                }

                resultDiv.className = `result ${response.ok ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <h3>${response.ok ? '‚úÖ' : '‚ö†Ô∏è'} ${config.name}</h3>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>–í—Ä–µ–º—è:</strong> ${duration}ms</p>
                    <p><strong>URL:</strong> ${config.url}</p>
                    <p><strong>Content-Type:</strong> ${contentType || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <details>
                        <summary>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (${typeof responseData})</summary>
                        <pre>${typeof responseData === 'string' ? responseData : JSON.stringify(responseData, null, 2)}</pre>
                    </details>
                `;
                
            } catch (error) {
                const duration = Date.now() - startTime;
                let errorMessage = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                
                if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                    errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n' +
                                 '‚Ä¢ CORS –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (—Å–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞)\n' +
                                 '‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π URL\n' +
                                 '‚Ä¢ –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω\n' +
                                 '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–º (HTTPS ‚Üí HTTP)';
                } else if (error instanceof Error) {
                    errorMessage = error.message;
                }
                
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå ${config.name}</h3>
                    <p><strong>–û—à–∏–±–∫–∞:</strong></p>
                    <pre style="white-space: pre-line;">${errorMessage}</pre>
                    <p><strong>–í—Ä–µ–º—è:</strong> ${duration}ms</p>
                    <p><strong>URL:</strong> ${config.url}</p>
                    ${errorMessage.includes('CORS') ? `
                        <div class="warning" style="margin-top: 10px; padding: 10px;">
                            <strong>üí° –°–æ–≤–µ—Ç:</strong> –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API —Å CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
                            <br />‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è CORS
                            <br />‚Ä¢ Postman –∏–ª–∏ –¥—Ä—É–≥–∏–µ API –∫–ª–∏–µ–Ω—Ç—ã  
                            <br />‚Ä¢ –ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä
                        </div>
                    ` : ''}
                `;
            }
        }

        function testWorkingAPI() {
            testAPI({
                name: "JSONPlaceholder API (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å)",
                method: "GET",
                url: "https://jsonplaceholder.typicode.com/posts/1",
                headers: {
                    "Content-Type": "application/json"
                }
            });
        }

        function testCORSBlocked() {
            testAPI({
                name: "GitHub API –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω CORS)",
                method: "GET", 
                url: "https://api.github.com/user",
                headers: {
                    "Accept": "application/vnd.github+json",
                    "User-Agent": "APIfy-Tester"
                }
            });
        }

        function testInvalidURL() {
            testAPI({
                name: "–ù–µ–≤–µ—Ä–Ω—ã–π URL (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É)",
                method: "GET",
                url: "https://nonexistent-api-url-12345.com/test",
                headers: {
                    "Content-Type": "application/json"
                }
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Ä–∞–±–æ—á–µ–≥–æ API
        setTimeout(() => {
            testWorkingAPI();
        }, 1000);
    </script>
</body>
</html>