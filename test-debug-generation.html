<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        button { padding: 12px 24px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 500px; overflow-y: auto; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #d1ecf1; border-color: #bee5eb; }
        .info { background: #e2e3e5; border-color: #d6d8db; margin-bottom: 20px; padding: 15px; border-radius: 5px; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ —Å Gemini</h1>
    
    <div class="info">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
        –≠—Ç–æ—Ç —Ç–µ—Å—Ç–µ—Ä –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–µ—Å—Ç–æ–≤.<br>
        API Key: AIzaSyCG4ZqZozFNuIO1Kt1o7KhbunDFBH5KhWQ<br>
        –ú–æ–¥–µ–ª—å: gemini-1.5-flash-latest
    </div>

    <h2>üß™ –¢–µ—Å—Ç—ã</h2>
    <button onclick="testDebugGeneration()" id="debugBtn">üîß –ü–æ–ª–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞</button>
    <button onclick="testOriginalEndpoint()" id="originalBtn">üìã –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π endpoint</button>
    <button onclick="testGeminiDirect()" id="geminiBtn">ü§ñ Gemini –Ω–∞–ø—Ä—è–º—É—é</button>
    
    <div id="result"></div>

    <script>
        async function testDebugGeneration() {
            const resultDiv = document.getElementById('result');
            const btn = document.getElementById('debugBtn');
            
            btn.disabled = true;
            resultDiv.className = 'result loading';
            resultDiv.textContent = '‚è≥ –ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–Ω—É—é –æ—Ç–ª–∞–¥–∫—É...';
            
            try {
                console.log('=== –û–¢–õ–ê–î–ö–ê –ì–ï–ù–ï–†–ê–¶–ò–ò ===');
                
                const response = await fetch('/api/test-generation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                
                const data = await response.json();
                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ –û—Ç–ª–∞–¥–∫–∞ —É—Å–ø–µ—à–Ω–∞!\n\n` +
                        `–ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:\n${data.simpleResult}\n\n` +
                        `–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤:\n${data.testsResult}\n\n` +
                        `–û–∫—Ä—É–∂–µ–Ω–∏–µ:\n${JSON.stringify(data.environment, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ª–∞–¥–∫–∏:\n${data.error}\n\n` +
                        `–î–µ—Ç–∞–ª–∏:\n${data.details}\n\n` +
                        `–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                btn.disabled = false;
            }
        }

        async function testOriginalEndpoint() {
            const resultDiv = document.getElementById('result');
            const btn = document.getElementById('originalBtn');
            
            btn.disabled = true;
            resultDiv.className = 'result loading';
            resultDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π endpoint...';
            
            try {
                const response = await fetch('/api/ai/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'generateExecutableTests',
                        data: {
                            serviceName: 'JSONPlaceholder'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.result) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n${data.result}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ endpoint:\n${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n\n–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                btn.disabled = false;
            }
        }

        async function testGeminiDirect() {
            const resultDiv = document.getElementById('result');
            const btn = document.getElementById('geminiBtn');
            
            btn.disabled = true;
            resultDiv.className = 'result loading';
            resultDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É—é Gemini –Ω–∞–ø—Ä—è–º—É—é...';
            
            try {
                const response = await fetch('/api/test-gemini-direct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: '–°–æ–∑–¥–∞–π JSON –º–∞—Å—Å–∏–≤ —Å –æ–¥–Ω–∏–º —Ç–µ—Å—Ç–æ–º –¥–ª—è JSONPlaceholder API'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Gemini –Ω–∞–ø—Ä—è–º—É—é —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n–û—Ç–≤–µ—Ç:\n${data.response}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ Gemini:\n${data.error}\n\n–î–µ—Ç–∞–ª–∏:\n${data.details}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                btn.disabled = false;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞—é –∞–≤—Ç–æ—Ç–µ—Å—Ç...');
            setTimeout(testDebugGeneration, 1000);
        });
    </script>
</body>
</html>