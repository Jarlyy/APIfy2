<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ —Å Gemini</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #4285f4;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #4285f4;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #3367d6;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .error {
            background: #ffeaea;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .loading {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        .info {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            color: #7b1fa2;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ —Å Google Gemini</h1>
        
        <div class="info">
            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
            –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é API —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é Google Gemini.<br>
            –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: analyzeService, generateTests, generateExecutableTests, generateScenarios
        </div>

        <!-- –ê–Ω–∞–ª–∏–∑ —Å–µ—Ä–≤–∏—Å–∞ -->
        <div class="test-section">
            <h2>üîç –ê–Ω–∞–ª–∏–∑ API —Å–µ—Ä–≤–∏—Å–∞</h2>
            <div class="form-group">
                <label for="analyzeService">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞:</label>
                <input 
                    type="text" 
                    id="analyzeService" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: GitHub API, OpenWeather API, JSONPlaceholder"
                    value="GitHub API"
                />
            </div>
            <button onclick="testAction('analyzeService', 'analyzeService')">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å</button>
            <div id="analyzeResult" class="result" style="display: none;"></div>
        </div>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ -->
        <div class="test-section">
            <h2>üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤</h2>
            <div class="form-group">
                <label for="generateTests">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞:</label>
                <input 
                    type="text" 
                    id="generateTests" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: JSONPlaceholder, REST Countries API"
                    value="JSONPlaceholder"
                />
            </div>
            <button onclick="testAction('generateTests', 'generateTests')">üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã</button>
            <div id="generateTestsResult" class="result" style="display: none;"></div>
        </div>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤ -->
        <div class="test-section">
            <h2>‚ö° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</h2>
            <div class="form-group">
                <label for="generateExecutable">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞:</label>
                <input 
                    type="text" 
                    id="generateExecutable" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: JSONPlaceholder, ReqRes API"
                    value="JSONPlaceholder"
                />
            </div>
            <button onclick="testAction('generateExecutableTests', 'generateExecutable')">‚ö° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ç–µ—Å—Ç—ã</button>
            <div id="generateExecutableResult" class="result" style="display: none;"></div>
        </div>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ -->
        <div class="test-section">
            <h2>üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</h2>
            <div class="form-group">
                <label for="generateScenarios">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:</label>
                <textarea 
                    id="generateScenarios" 
                    rows="4"
                    placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤..."
                >GET /users - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
POST /users - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /users/{id} - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
PUT /users/{id} - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE /users/{id} - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</textarea>
            </div>
            <button onclick="testAction('generateScenarios', 'generateScenarios', true)">üìù –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏</button>
            <div id="generateScenariosResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
        <div class="test-section">
            <h2>üöÄ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç</h2>
            <button onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <div id="allTestsResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        async function testAction(action, inputId, isApiDoc = false) {
            const resultId = action === 'generateTests' ? 'generateTestsResult' : 
                           action === 'generateExecutableTests' ? 'generateExecutableResult' :
                           action === 'generateScenarios' ? 'generateScenariosResult' :
                           'analyzeResult';
            
            const resultDiv = document.getElementById(resultId);
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            if (!value) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = `‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ${action}...`;
            
            try {
                const requestBody = {
                    action: action,
                    data: isApiDoc ? { apiDoc: value } : { serviceName: value }
                };
                
                const response = await fetch('/api/ai/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (response.ok && data.result) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ –£—Å–ø–µ—à–Ω–æ!\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n${data.result}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            }
        }

        async function runAllTests() {
            const resultDiv = document.getElementById('allTestsResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = '‚è≥ –ó–∞–ø—É—Å–∫–∞—é –≤—Å–µ —Ç–µ—Å—Ç—ã...\n\n';
            
            const tests = [
                { action: 'analyzeService', data: { serviceName: 'GitHub API' }, name: '–ê–Ω–∞–ª–∏–∑ GitHub API' },
                { action: 'generateTests', data: { serviceName: 'JSONPlaceholder' }, name: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è JSONPlaceholder' },
                { action: 'generateExecutableTests', data: { serviceName: 'ReqRes API' }, name: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è ReqRes' },
                { action: 'generateScenarios', data: { apiDoc: 'GET /users, POST /users, GET /users/{id}' }, name: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤' }
            ];
            
            let results = '';
            let successCount = 0;
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                results += `${i + 1}. ${test.name}:\n`;
                
                try {
                    const response = await fetch('/api/ai/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(test)
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.result) {
                        results += `‚úÖ –£—Å–ø–µ—à–Ω–æ\n`;
                        results += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${data.result.substring(0, 200)}...\n\n`;
                        successCount++;
                    } else {
                        results += `‚ùå –û—à–∏–±–∫–∞: ${data.error}\n\n`;
                    }
                } catch (error) {
                    results += `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}\n\n`;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                resultDiv.textContent = `‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–æ ${i + 1}/${tests.length} —Ç–µ—Å—Ç–æ–≤...\n\n${results}`;
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            resultDiv.className = successCount === tests.length ? 'result success' : 'result error';
            resultDiv.textContent = `üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –£—Å–ø–µ—à–Ω–æ: ${successCount}/${tests.length}\n\n${results}`;
        }
    </script>
</body>
</html>